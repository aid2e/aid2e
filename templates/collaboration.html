{% extends "base.html" %}

{% block title %}Collaboration - AID2E{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
  <h1>AID2E Collaboration</h1>
  <p>Meet the talented team of researchers, scientists, and experts working together to advance AI-assisted detector design for the Electron Ion Collider.</p>
</div>

<!-- Collaboration Content -->
<div class="w3-container darker-bg" style="padding: clamp(2rem, 4vw, 4rem) clamp(1rem, 3vw, 2rem);">
  <div class="w3-content">
    {% for institution in institutions %}
    <div class="collaboration-section">
      <!-- Institution Header -->
      <div class="institution-header" onclick="toggleInstitution('{{ institution.short_name }}')">
        <div class="institution-info">
          <img src="assets/images/{{ institution.logo }}" alt="{{ institution.name }}" class="institution-logo-small">
          <h2>{{ institution.name }}</h2>
        </div>
        <i class="fa fa-chevron-down toggle-icon" id="toggle-{{ institution.short_name }}"></i>
      </div>
      
      <!-- Institution Content -->
      <div class="institution-content" id="content-{{ institution.short_name }}">
        {% set pi_members = [] %}
        {% set copi_members = [] %}
        {% set regular_members = [] %}
        {% set consultants = [] %}
        
        {% for member in institution.members %}
          {% if member.role == 'PI' %}
            {% set _ = pi_members.append(member) %}
          {% elif member.role == 'Co-PI' %}
            {% set _ = copi_members.append(member) %}
          {% elif member.role == 'Consultant' %}
            {% set _ = consultants.append(member) %}
          {% else %}
            {% set _ = regular_members.append(member) %}
          {% endif %}
        {% endfor %}
        
        <!-- PI Section -->
        {% if pi_members %}
        <div class="role-section">
          <h3 class="role-title">Principal Investigator</h3>
          <div class="members-grid">
            {% for member in pi_members %}
            {{ render_member_card(member) }}
            {% endfor %}
          </div>
        </div>
        {% endif %}
        
        <!-- Co-PI Section -->
        {% if copi_members %}
        <div class="role-section">
          <h3 class="role-title">Co-Principal Investigators</h3>
          <div class="members-grid">
            {% for member in copi_members %}
            {{ render_member_card(member) }}
            {% endfor %}
          </div>
        </div>
        {% endif %}
        
        <!-- Members Section -->
        {% if regular_members %}
        <div class="role-section">
          <h3 class="role-title">Team Members</h3>
          <div class="members-grid">
            {% for member in regular_members %}
            {{ render_member_card(member) }}
            {% endfor %}
          </div>
        </div>
        {% endif %}
        
        <!-- Consultants Section -->
        {% if consultants %}
        <div class="role-section">
          <h3 class="role-title">Consultants</h3>
          <div class="members-grid">
            {% for member in consultants %}
            {{ render_member_card(member) }}
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<script>
function toggleInstitution(institutionId) {
  const content = document.getElementById('content-' + institutionId);
  const icon = document.getElementById('toggle-' + institutionId);
  
  content.classList.toggle('active');
  icon.classList.toggle('active');
}
</script>
{% endblock %}

{% macro render_member_card(member) %}
<div class="flip-card" {% if member.url %}onclick="window.open('{{ member.url }}', '_blank')"{% endif %}>
  <div class="flip-card-inner">
    <!-- Front of card -->
    <div class="flip-card-front">
      {% if member.image %}
        <img src="{{ member.image }}" alt="{{ member.name }}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
        <div class="placeholder-image" style="display:none;">
          <i class="fa fa-user"></i>
        </div>
      {% else %}
        <div class="placeholder-image">
          <i class="fa fa-user"></i>
        </div>
      {% endif %}
      <h3>{{ member.name }}</h3>
      <p class="member-role">{{ member.role }}</p>
    </div>
    
    <!-- Back of card -->
    <div class="flip-card-back">
      <h3>{{ member.name }}</h3>
      <p><span class="label">Role:</span> {{ member.role }}</p>
      <p><span class="label">Designation:</span> {{ member.designation }}</p>
      {% if member.works %}
      <p><span class="label">Expertise:</span> {{ member.works }}</p>
      {% endif %}
      {% if member.url %}
      <a href="{{ member.url }}" target="_blank" class="visit-link" onclick="event.stopPropagation();">
        Visit Page <i class="fa fa-external-link"></i>
      </a>
      {% endif %}
    </div>
  </div>
</div>
{% endmacro %}
